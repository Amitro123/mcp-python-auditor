[tool.ruff]
# Target Python 3.11+
target-version = "py311"
line-length = 150
exclude = [
    ".venv",
    ".git",
    "__pycache__",
    "build",
    "dist",
    "site-packages",
    "venv",
    "*.egg-info",
    ".pytest_cache",
    ".mypy_cache",
    ".ruff_cache",
    "htmlcov",
    "reports",
    "backups",
]

[tool.ruff.lint]
# Strategy: Select standard rules, then ignore specific categories.
select = ["E", "F", "W", "I", "B", "S", "C90"]

ignore = [
    "D",       # Docstrings: Disable strict docstring requirements (too noisy for existing code)
    "ANN",     # Annotations: Disable strict type hinting checks (let Mypy handle this if needed)
    "TD",      # TODOs: Don't flag TODO comments as errors
    "FIX",     # FIXMEs: Don't flag FIXME comments as errors
    "COM812",  # Conflicts with formatter
    "ISC001",  # Conflicts with formatter
    "CPY",     # Copyright notices
    "EM",      # Error messages formatting (too pedantic)
    "TRY003",  # Long exception messages (too pedantic)
    "S311",    # Pseudo-random generators (acceptable for non-crypto usage)
    "T201",    # Print statements (acceptable in CLI apps)
    "G004",    # Logging with f-strings (acceptable performance hit)
    "ERA001",  # Commented-out code (high false positive rate)
    "PLR0913", # Too many arguments in function call (refactor later)
    "PLR0912", # Too many branches (refactor later)
    "PLR0915", # Too many statements (refactor later)
    "E501",    # Line too long (template strings in reports/CI config are hard to break)
    # NOTE: C901 (McCabe complexity) is NOT ignored - reports high-complexity functions
    
    # Added to reduce noise during remediation
    "FBT",     # Boolean trap (too strict for existing codebase)
    "BLE",     # Blind exception catching (common in this codebase)
    "PLC0415", # Imports outside top-level (used for lazy loading)
    "DTZ",     # Naive datetime usage
    "PTH",     # Pathlib vs os.path (legacy code)
    "SIM",     # Simplicity suggestions (optional)
    "F841",    # Unused variables (often artifacts of refactoring)
    "ARG",     # Unused arguments (common in overrides/interfaces)
    "S603",    # Subprocess usage (audit tools require this)
]

[tool.ruff.lint.per-file-ignores]
# Tests are allowed to use asserts, private members, and magic values
"tests/**/*" = ["S101", "SLF001", "PLR2004", "ARG", "FBT"]
"app/main.py" = ["T201"]  # Allow print in entry point
"**/test_*.py" = ["S101", "SLF001", "PLR2004", "ARG", "FBT"]
"**/*_test.py" = ["S101", "SLF001", "PLR2004", "ARG", "FBT"]

[tool.ruff.lint.isort]
combine-as-imports = true
force-wrap-aliases = true
split-on-trailing-comma = true

[tool.ruff.lint.mccabe]
# McCabe complexity threshold
max-complexity = 10

[tool.ruff.lint.pylint]
max-args = 8
max-branches = 15
max-statements = 60

[tool.pytest.ini_options]
testpaths = ["tests"]
python_files = ["test_*.py", "*_test.py"]
python_classes = ["Test*"]
python_functions = ["test_*"]
addopts = "-v --tb=short"

[tool.bandit]
exclude_dirs = ["tests", "test", ".venv", "venv", "node_modules", ".git"]
exclude = ["test_*.py", "*_test.py", "**/test_*.py"]
skips = ["B101", "B404", "B603"]

[tool.coverage.run]
source = ["app", "mcp_fastmcp_server"]
branch = true
omit = [
    "*/tests/*",
    "*/.venv/*",
    "*/venv/*",
    "*/__pycache__/*",
    "*/site-packages/*",
    "*/node_modules/*",
    "*.egg-info/*",
    "setup.py",
    "conftest.py",
    "test_*.py",
    "*_test.py",
    "tests/*",
]

[tool.coverage.report]
exclude_lines = [
    "pragma: no cover",
    "def __repr__",
    "raise NotImplementedError",
    "if __name__ == .__main__.:",
    "if TYPE_CHECKING:",
    "pass",
]
fail_under = 0
show_missing = true
skip_covered = false

[tool.coverage.html]
directory = "htmlcov"
