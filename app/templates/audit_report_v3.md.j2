# üîç Python Audit Report

**Generated**: {{ timestamp }}  
**Repository**: {{ repo_name }}  
**Duration**: {{ duration if duration else "N/A" }}

---

## üìä Overall Score: {{ score }}/100 ({{ grade }})

### Score Breakdown
| Component | Penalty | Details |
|-----------|---------|---------|
| üîí Security | {{ "-" ~ security_penalty if security_penalty > 0 else "0" }} | {{ security.total_issues }} issues, {{ secrets.total_secrets }} secrets |
| ‚úÖ Testing | {{ "-" ~ testing_penalty if testing_penalty > 0 else "0" }} | {{ tests.coverage_percent }}% coverage |
| üßπ Quality | {{ "-" ~ quality_penalty if quality_penalty > 0 else "0" }} | {{ deadcode.total_items }} dead code items |
| **Final** | **{{ score }}** | Grade: {{ grade }} |

---

## üîí Security Analysis

**Status**: {{ security_severity.label }}  
**Issues Found**: {{ security.total_issues }}  
**Secrets Detected**: {{ secrets.total_secrets }}

{% if security.total_issues > 0 %}
### üõ°Ô∏è Security Issues

{% for issue in security.issues[:15] %}
- **{{ issue.severity }}**: {{ issue.message }} (`{{ issue.file }}:{{ issue.line }}`)
{% endfor %}

{% if security.total_issues > 15 %}
<details>
<summary>‚ö†Ô∏è See {{ security.total_issues - 15 }} more security issues</summary>

{% for issue in security.issues[15:] %}
- **{{ issue.severity }}**: {{ issue.message }} (`{{ issue.file }}:{{ issue.line }}`)
{% endfor %}

</details>
{% endif %}

{% else %}
‚úÖ No security issues detected by Bandit
{% endif %}

{% if secrets.total_secrets > 0 %}
### üîë Secrets Detected
‚ö†Ô∏è **Found {{ secrets.total_secrets }} potential secrets!**

| File | Type | Secret (Masked) | Line |
|------|------|-----------------|------|
{% for secret in secrets.secrets %}
| `{{ secret.file }}` | {{ secret.type }} | `{{ secret.hashed_secret }}` | {{ secret.line }} |
{% endfor %}
{% endif %}

---

## üß™ Test Coverage

**Coverage**: {{ tests.coverage_percent }}%  
**Assessment**: {{ coverage_severity.label }}  
**Status**: {{ coverage_severity.description }}

**Recommendation**: {{ coverage_severity.recommendation }}

{% if tests.total_tests > 0 %}
**Total Tests**: {{ tests.total_tests }}
- Unit: {{ tests.test_breakdown.unit }}
- Integration: {{ tests.test_breakdown.integration }}
- E2E: {{ tests.test_breakdown.e2e }}
{% else %}
**Test Files**: {{ tests.total_test_files }}
- Unit: {{ tests.test_breakdown.unit }}
- Integration: {{ tests.test_breakdown.integration }}
- E2E: {{ tests.test_breakdown.e2e }}
{% endif %}

{% if tests.warning %}
‚ö†Ô∏è **Warning**: {{ tests.warning }}
{% endif %}

{% if tests.tests_passed > 0 or tests.tests_failed > 0 %}
### Tests & Coverage Details

**Test Results**:
- ‚úÖ Passed: {{ tests.tests_passed }}
- ‚ùå Failed: {{ tests.tests_failed }}
- ‚è≠Ô∏è Skipped: {{ tests.tests_skipped }}

{% if tests.coverage_report %}
**Coverage Report**:
```
{{ tests.coverage_report }}
```
{% endif %}

{% if tests.test_list and tests.test_list|length > 0 %}
**Test Files Scanned** ({{ tests.test_list|length }} tests):
{% for test in tests.test_list[:10] %}
- {{ test }}
{% endfor %}
{% if tests.test_list|length > 10 %}
... and {{ tests.test_list|length - 10 }} more tests
{% endif %}
{% endif %}
{% endif %}

---

## üìÇ Project Structure

{% if structure.total_py_files %}
**Python Files**: {{ structure.total_py_files }}  
**Total Lines**: {{ structure.total_lines }}  
**Top Directories**: {{ structure.top_directories|join(', ') }}

### Directory Tree
```
{{ structure.directory_tree }}
```
{% else %}
No structure information available
{% endif %}

---

## üßπ Code Quality

### Linting Issues
{{ quality.total_issues }} issues found

{% if quality.total_issues > 0 %}
- High Severity: {{ quality.severity_counts.HIGH or 0 }}
- Medium Severity: {{ quality.severity_counts.MEDIUM or 0 }}
- Low: {{ quality.severity_counts.LOW or 0 }}

**Top Issues**:
{% for issue in quality.issues[:10] %}
- {{ issue.severity }}: {{ issue.message }} (`{{ issue.file }}:{{ issue.line }}`)
{% endfor %}

{% else %}
‚úÖ No linting issues detected
{% endif %}

### Dead Code
{{ deadcode.total_items }} items found

{% if deadcode.total_items > 0 %}
- Unused variables: {{ deadcode.unused_vars|length }}
- Unused imports: {{ deadcode.unused_imports|length }}
- Dead functions: {{ deadcode.dead_functions|length }}

**Top Issues**:
{% for item in (deadcode.unused_vars + deadcode.unused_imports + deadcode.dead_functions)[:15] %}
- `{{ item.name }}` in {{ item.file }}:{{ item.line }}
{% endfor %}

{% else %}
‚úÖ No dead code detected
{% endif %}

### Code Duplication
{{ duplication.total_duplicates }} similar code blocks found

{% if duplication.total_duplicates > 0 %}

{% if duplication.total_duplicates > 10 %}
‚ö†Ô∏è High duplication detected. Consider refactoring common patterns.
{% endif %}

#### üé≠ DUPLICATES

**Most Duplicated Functions** (similarity > 80%):
{# Filter items first to avoid repeated iteration in template #}
{% set duplicates_list = [] %}
{% for dup in duplication.duplicates %}
    {% if dup.similarity > 80 %}
        {% set _ = duplicates_list.append(dup) %}
    {% endif %}
{% endfor %}

{% for dup in duplicates_list[:15] %}
- `{{ dup.function_name }}` ({{ dup.similarity|round(1) }}% similar) - {{ dup.count }} instances
  - Locations: {{ dup.locations|join(', ') }}
{% endfor %}

{% if duplicates_list|length > 15 %}
<details>
<summary>‚ñ∂Ô∏è See {{ duplicates_list|length - 15 }} more duplicates</summary>

{% for dup in duplicates_list[15:] %}
- `{{ dup.function_name }}` ({{ dup.similarity|round(1) }}% similar) - {{ dup.count }} instances
  - Locations: {{ dup.locations|join(', ') }}
{% endfor %}

</details>
{% endif %}
{% else %}
‚úÖ No significant code duplication detected
{% endif %}

---

## üìä Detailed Findings

### Architecture Overview
{% if architecture.total_files %}
**Total Files Analyzed**: {{ architecture.total_files }}  
**Total Dependencies**: {{ architecture.total_dependencies }}

#### Dependency Graph
```mermaid
{{ architecture.mermaid_graph }}
```
{% else %}
Architecture analysis not available
{% endif %}

### Efficiency Analysis
{% if efficiency.total_high_complexity > 0 %}
**High Complexity Functions**: {{ efficiency.total_high_complexity }}

{% for func in efficiency.high_complexity_functions[:5] %}
- `{{ func.name }}` in {{ func.file }} (complexity: {{ func.complexity }})
{% endfor %}
{% else %}
‚úÖ No high-complexity functions detected (all under threshold)
{% endif %}

### Cleanup Recommendations
{% if cleanup.total_size_mb > 0 %}
**Cleanup Available**: {{ cleanup.total_size_mb }}MB

**Targets**:
{% for target, count in cleanup['cleanup_targets'].items() %}
- {{ target }}: {{ count }} directories
{% endfor %}

**Items**:
{% for item in cleanup['cleanup_items'][:10] %}
- {{ item }}
{% endfor %}
{% else %}
‚úÖ No cleanup needed
{% endif %}

---

## üí° Recommendations

**Based on the calculated score of {{ score }}/100:**

{# Build recommendations list with dynamic numbering #}
{% set ns = namespace(num=1) %}
{% if testing_penalty >= 30 %}
{{ ns.num }}. **üî¥ CRITICAL - Test Coverage**: {{ coverage_severity.recommendation }}
{% set ns.num = ns.num + 1 %}
{% endif %}
{% if security_penalty >= 20 %}
{{ ns.num }}. **üî¥ CRITICAL - Security**: Address {{ security.total_issues + secrets.total_secrets }} security findings immediately
{% set ns.num = ns.num + 1 %}
{% endif %}
{% if quality_penalty >= 15 %}
{{ ns.num }}. **üü° HIGH - Code Quality**: Clean up {{ deadcode.total_items }} dead code items
{% set ns.num = ns.num + 1 %}
{% endif %}
{% if duplication.total_duplicates > 50 %}
{{ ns.num }}. **üü° MEDIUM - Duplication**: Consider refactoring {{ duplication.total_duplicates }} duplicate code blocks
{% set ns.num = ns.num + 1 %}
{% endif %}
{% if score < 70 %}
{{ ns.num }}. **Overall**: Current grade ({{ grade }}) indicates significant technical debt. Prioritize above items.
{% elif score < 90 %}
{{ ns.num }}. **Overall**: Good foundation ({{ grade }}). Focus on incremental improvements.
{% else %}
{{ ns.num }}. **Overall**: Excellent codebase ({{ grade }}). Maintain current standards.
{% endif %}

---

## üîß Tools Executed

{% for tool in tools_summary %}
- **{{ tool.name }}**: {{ tool.status }} ({{ tool.duration_s }}s)
{% endfor %}

---

*This report uses pre-calculated scores based on the algorithm in README.md. All numeric values are deterministic and not subject to interpretation.*

